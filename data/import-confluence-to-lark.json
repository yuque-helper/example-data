{
  "title": "Confluence 迁移到语雀",
  "slug": 577179,
  "body_html": "<h2 id=\"da3zhf\" data-type=\"h\"><a class=\"anchor\" id=\"\b实现原理\" href=\"#da3zhf\"></a>\b实现原理</h2><div data-type=\"p\"></div><div data-type=\"p\">基于 Confluence 自带的 「HTML Export」功能，可以将整个空间（Space）以 HTML 文件格式导出到一个 zip 文件中。这样语雀就能使用这个 zip 文件来将数据导入，并且基于它创建一个全新的知识库。</div><div data-type=\"p\"></div><h2 id=\"ygt1te\" data-type=\"h\"><a class=\"anchor\" id=\"导入步骤\" href=\"#ygt1te\"></a>导入步骤</h2><div data-type=\"p\"></div><div data-type=\"p\">大致分为 2 步：</div><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">先从 Confluence 导出 HTML zip 文件</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">在新建知识库里选择导入 Confluence </div></li></ul><div data-type=\"p\"></div><h3 id=\"9pzuwu\" data-type=\"h\"><a class=\"anchor\" id=\"从-confluence-导出-html-zip-文件\" href=\"#9pzuwu\"></a>从 Confluence 导出 HTML zip 文件</h3><h4 id=\"mx3nxt\" data-type=\"h\"><a class=\"anchor\" id=\"confluence-5.x-的操作界面\" href=\"#mx3nxt\"></a>Confluence 5.x 的操作界面</h4><div data-type=\"p\"><div id=\"kgbfll\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231313902-c6b87724-85d1-4e1c-a5dd-1e5995397a75.png\" data-width=\"747\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231313902-c6b87724-85d1-4e1c-a5dd-1e5995397a75.png\" width=\"747\"/></div></div><div data-type=\"p\"></div><div data-type=\"p\"><div id=\"2gtzbh\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231938470-bd5b94b4-9232-4c52-afaf-6df04b707076.png\" data-width=\"661\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231938470-bd5b94b4-9232-4c52-afaf-6df04b707076.png\" width=\"661\"/></div></div><h4 id=\"5sdcya\" data-type=\"h\"><a class=\"anchor\" id=\"confluence-6.x-的操作界面\" href=\"#5sdcya\"></a>Confluence 6.x 的操作界面</h4><div data-type=\"p\"></div><div data-type=\"p\"><div id=\"evfaav\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231787866-85be2644-d848-4812-b3a1-161b5c4b0bf7.png\" data-width=\"747\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231787866-85be2644-d848-4812-b3a1-161b5c4b0bf7.png\" width=\"747\"/></div></div><div data-type=\"p\"></div><div data-type=\"p\"><div id=\"6kf4as\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231827263-76dbb149-e529-4b45-8924-fcb7de6403db.png\" data-width=\"747\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231827263-76dbb149-e529-4b45-8924-fcb7de6403db.png\" width=\"747\"/></div></div><div data-type=\"p\"></div><div data-type=\"p\"><div id=\"osn8tf\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231858288-d3ac64f0-0b85-4dfb-81e7-bb23581e1baf.png\" data-width=\"747\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1534231858288-d3ac64f0-0b85-4dfb-81e7-bb23581e1baf.png\" width=\"747\"/></div></div><div data-type=\"p\"></div><h3 id=\"ha4meq\" data-type=\"h\"><a class=\"anchor\" id=\"新建知识库中导入-confluence\" href=\"#ha4meq\"></a>新建知识库中导入 Confluence</h3><div data-type=\"p\"></div><div data-type=\"p\">在语雀上直接选择新建知识库，在更多操作里选择 “导入 Confluence 知识库”</div><div data-type=\"p\"></div><div data-type=\"p\"><div id=\"tsdvib\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84147/1540190471972-b59f2708-18da-4ae2-8508-2fc040727ae4.png\" data-width=\"747\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84147/1540190471972-b59f2708-18da-4ae2-8508-2fc040727ae4.png\" width=\"747\"/></div></div><div data-type=\"p\"></div><div data-type=\"p\">在表单页面里输入你之前的 Confluence 地址（用来批量替换原文档中链接成语雀链接），然后在上传之前导出的 Zip 点击新建即可。</div><div data-type=\"p\"></div><div data-type=\"p\"><div id=\"orxseh\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84147/1540190486453-6eb60563-4176-410d-9499-8b2d5ce7665a.png\" data-width=\"747\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84147/1540190486453-6eb60563-4176-410d-9499-8b2d5ce7665a.png\" width=\"747\"/></div></div><div data-type=\"p\"></div><h2 id=\"目前已支持的平台\" data-type=\"h\"><a class=\"anchor\" id=\"经过测试的-confluence-版本\" href=\"#目前已支持的平台\"></a>经过测试的 Confluence 版本</h2><div data-type=\"p\"></div><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">Confluence 5.2.3</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\"><span data-type=\"color\" style=\"color:rgb(0, 0, 0)\">Confluence 6.x</span></div></li></ul><div data-type=\"p\"></div><h2 id=\"dnuzrg\" data-type=\"h\"><a class=\"anchor\" id=\"常见问题\" href=\"#dnuzrg\"></a>常见问题</h2><div data-type=\"p\"></div><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">导出 zip 文件太大，然后导入时间超时，一直卡在 99%。</div><div data-type=\"p\">原因分析：一般是一个 Space 太大了，导致整个导入任务很难完成。</div><div data-type=\"p\">解决办法：将 Space 拆分导出，分成多个语雀知识库来导入。</div><div data-type=\"p\"><div id=\"qmhvzo\" data-type=\"image\" data-display=\"block\" data-align=\"left\" data-src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1535093022625-fdc4a36f-bcb6-49a6-a678-b54a44dc7eee.png\" data-width=\"719\"><img src=\"https://cdn.nlark.com/yuque/0/2018/png/84137/1535093022625-fdc4a36f-bcb6-49a6-a678-b54a44dc7eee.png\" width=\"719\"/></div></div></li></ul><div data-type=\"p\"></div><h2 id=\"更新历史\" data-type=\"h\"><a class=\"anchor\" id=\"更新历史\" href=\"#更新历史\"></a>更新历史</h2><div data-type=\"p\"></div><h3 id=\"gmpdyg\" data-type=\"h\"><a class=\"anchor\" id=\"2.0.0\" href=\"#gmpdyg\"></a>2.0.0</h3><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">抛弃命令行工具模式，基于 Confluence 的 HTML Export 功能来实现数据导入到语雀。</div></li></ul><div data-type=\"p\"></div><h3 id=\"kwqgvt\" data-type=\"h\"><a class=\"anchor\" id=\"1.2.0\" href=\"#kwqgvt\"></a>1.2.0</h3><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">新增文档关联功能，用于解决文档内部链接的问题：\n迁移会记录 Confluence 和语雀文档的关联关系，并替换正文里面的 Confluence 页面链接，改为 <code>/importlink?url=</code> 这样的地址。当用户访问这个地址的时候，会尝试查找关联信息，如果有将会打开在语雀上的文档页面。</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">改进文档迁移的格式处理细节，存储到语雀上用所见即所得模式。</div></li></ul><div data-type=\"p\"></div><h3 id=\"ugf8bu\" data-type=\"h\"><a class=\"anchor\" id=\"1.1.0\" href=\"#ugf8bu\"></a>1.1.0</h3><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">新增 <code>confluence</code> 配置项，用于配置附件下载的信息；</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">正文从 Confluence Web 页面获取，以解决之前格式转换实现不完整导致格式流失的问题；</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">尝试修正附件转存的细节；</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">当目标团队找不到的时候，给出正确的提示信息；</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">改进附件、图片转存的细节，确保每次上传都是唯一地址，避免 CDN 缓存带来的负面影响（例如之前转存失败了错误的图片内容，再次上传 URL 相同，OSS 也是相同地址，无法覆盖）。</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">修正评论迁移的时候，因为昵称无法找到，导致迁移失败的问题;</div></li></ul><div data-type=\"p\"></div><h3 id=\"更新历史\" data-type=\"h\"><a class=\"anchor\" id=\"1.0.1\" href=\"#更新历史\"></a>1.0.1</h3><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">修正附件转移存储的域名不正确的问题；</div></li><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">默认主机名改为 <a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://yuque.com;/\" class=\"bi-link\">https://yuque.com；</a></div></li></ul><div data-type=\"p\"></div><h3 id=\"更新历史\" data-type=\"h\"><a class=\"anchor\" id=\"1.0.0\" href=\"#更新历史\"></a>1.0.0</h3><ul data-type=\"unordered-list\"><li data-type=\"list-item\" data-list-type=\"unordered-list\"><div data-type=\"p\">首次对外发布；</div></li></ul><div data-type=\"p\"></div>"
}